---
import { Icon } from "astro-icon/components";
import AddToCalendarButton from "./AddToCalendarButton.astro";
import LogoSVG from "../assets/logo.svg";
---

<style>
  .menu-open {
    opacity: 1;
    pointer-events: auto;
  }

  .lock-scroll {
    overflow: hidden;
  }
</style>

<header class="sticky top-0 z-50">
  <div class="w-full py-4 px-4 border-b h-24 sm:h-20 border-gray-200 bg-white">
    <nav class="max-w-300 mx-auto flex items-center justify-between h-full">
      <a
        href="/"
        class="text-2xl font-bold text-gray-900 hover:text-gray-700 transition-colors"
        aria-label="Rowerem z Sercem - logo"
      >
        <LogoSVG class="w-16" />
      </a>
      <ul class="items-center gap-6 hidden sm:flex">
        <li>
          <a
            href="/info"
            class="text-gray-600 hover:text-gray-900 transition-colors"
            >Informacje</a
          >
        </li>
        <li>
          <a
            href="/kontakt"
            class="text-gray-600 hover:text-gray-900 transition-colors"
            >Kontakt</a
          >
        </li>
        <li>
          <AddToCalendarButton />
        </li>
      </ul>

      <div class="sm:hidden">
        <button
          transition:persist
          class="hamburger hamburger--spin"
          id="menu-toggle"
          type="button"
        >
          <span class="hamburger-box">
            <span class="hamburger-inner"></span>
          </span>
        </button>
      </div>
    </nav>
  </div>
  <div
    class="h-[calc(100dvh-6rem)] w-full bg-gray-50 absolute opacity-0 pointer-events-none
         transition-opacity duration-300 ease-out"
    id="mobile-menu"
  >
    <div class="">
      <div class="p-4">
        <div>
          <h3 class="text-lg font-semibold text-gray-900 mb-4">Menu</h3>
          <ul class="space-y-4">
            <li>
              <a
                href="/info"
                class="text-gray-600 hover:text-gray-900 transition-colors"
                >Informacje</a
              >
            </li>
            <li>
              <a
                href="/kontakt"
                class="text-gray-600 hover:text-gray-900 transition-colors"
                >Kontakt</a
              >
            </li>
          </ul>
        </div>
      </div>
      <div class="absolute w-full bottom-0 p-4">
        <div class="mb-8">
          <AddToCalendarButton />
        </div>
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Znajd≈∫ nas</h3>
        <ul class="space-y-4">
          <li>
            <a
              href="https://www.instagram.com/roweremzsercem/"
              class="flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors"
            >
              <Icon name="tabler:brand-instagram" class="w-5 h-5" />
              Instagram</a
            >
          </li>
          <li>
            <a
              href="https://www.tiktok.com/@rowerem_z_sercem"
              class="flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors"
            >
              <Icon name="tabler:brand-tiktok" class="w-5 h-5" />
              TikTok</a
            >
          </li>
          <li>
            <a
              href="https://www.youtube.com/@roweremzsercem"
              class="flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors"
            >
              <Icon name="tabler:brand-youtube" class="w-5 h-5" />
              YouTube Shorts</a
            >
          </li>
        </ul>
        <div
          class="pt-4 border-t border-gray-200 text-center text-gray-600 text-base/loose mt-4"
        >
          <p>
            &copy; 2026 Rowerem z Sercem<br /><a
              href="https://tancz.my"
              class="text-gray-400 hover:underline transition-all">tancz.my</a
            >
          </p>
        </div>
      </div>
    </div>
  </div>
</header>

<script is:inline>
  function handleMenuOpen(menu, btn, isOpen) {
    menu.classList.toggle("opacity-0", isOpen);
    menu.classList.toggle("pointer-events-none", isOpen);
    btn.setAttribute("aria-expanded", String(!isOpen));
    btn.classList.toggle("is-active", !isOpen);

    if (!isOpen) {
      document.body.classList.add("lock-scroll");
    } else {
      document.body.classList.remove("lock-scroll");
    }
  }

  document.addEventListener("astro:page-load", () => {
    const btn = document.getElementById("menu-toggle");
    const menu = document.getElementById("mobile-menu");

    let isOpen = false;

    if (btn && menu) {
      if (!isOpen) {
        btn.classList.remove("is-active");
      }

      btn.addEventListener("click", () => {
        handleMenuOpen(menu, btn, isOpen);
        isOpen = !isOpen;
      });
    } else {
      console.log(
        "Required elements 'menu-toggle' and 'mobile-menu' not found on site",
      );
    }

    // Make sure the element is hidden on screen orientation change
    addEventListener("resize", (event) => {
      if (window.innerWidth >= 640 && isOpen) {
        handleMenuOpen(menu, btn, true);
        isOpen = false;
      }
    });
  });
</script>
